import{t as te,s as I,r as V,x as B,y as ne,z as re,n as ae,A as oe,a as Y,B as ie,C as le,l as se,D as ue,E as q,F as ce,e as fe,G as de,H as Q}from"./index-s6c4EPi7.js";function pe(e){var r;const n=B(e);return(r=n==null?void 0:n.$el)!=null?r:n}const K=te?window:void 0,Se=te?window.document:void 0;function k(...e){let r,n,c,p;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,c,p]=e,r=K):[r,n,c,p]=e,!r)return oe;Array.isArray(n)||(n=[n]),Array.isArray(c)||(c=[c]);const o=[],a=()=>{o.forEach(f=>f()),o.length=0},x=(f,s,g,d)=>(f.addEventListener(s,g,d),()=>f.removeEventListener(s,g,d)),N=Y(()=>[pe(r),B(p)],([f,s])=>{if(a(),!f)return;const g=ie(s)?{...s}:s;o.push(...n.flatMap(d=>c.map(m=>x(f,d,m,g))))},{immediate:!0,flush:"post"}),b=()=>{N(),a()};return le(b),b}const L=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},U="__vueuse_ssr_handlers__",ye=he();function he(){return U in L||(L[U]=L[U]||{}),L[U]}function me(e,r){return ye[e]||r}function ve(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const we={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},R="vueuse-storage";function Ee(e,r,n,c={}){var p;const{flush:o="pre",deep:a=!0,listenToStorageChanges:x=!0,writeDefaults:N=!0,mergeDefaults:b=!1,shallow:f,window:s=K,eventFilter:g,onError:d=t=>{console.error(t)},initOnMounted:m}=c,y=(f?I:V)(typeof r=="function"?r():r);if(!n)try{n=me("getDefaultStorage",()=>{var t;return(t=K)==null?void 0:t.localStorage})()}catch(t){d(t)}if(!n)return y;const h=B(r),_=ve(h),S=(p=c.serializer)!=null?p:we[_],{pause:P,resume:W}=ne(y,()=>T(y.value),{flush:o,deep:a,eventFilter:g});return s&&x&&re(()=>{k(s,"storage",E),k(s,R,H),m&&E()}),m||E(),y;function T(t){try{if(t==null)n.removeItem(e);else{const i=S.write(t),v=n.getItem(e);v!==i&&(n.setItem(e,i),s&&s.dispatchEvent(new CustomEvent(R,{detail:{key:e,oldValue:v,newValue:i,storageArea:n}})))}}catch(i){d(i)}}function D(t){const i=t?t.newValue:n.getItem(e);if(i==null)return N&&h!=null&&n.setItem(e,S.write(h)),h;if(!t&&b){const v=S.read(i);return typeof b=="function"?b(v,h):_==="object"&&!Array.isArray(v)?{...h,...v}:v}else return typeof i!="string"?i:S.read(i)}function H(t){E(t.detail)}function E(t){if(!(t&&t.storageArea!==n)){if(t&&t.key==null){y.value=h;return}if(!(t&&t.key!==e)){P();try{(t==null?void 0:t.newValue)!==S.write(y.value)&&(y.value=D(t))}catch(i){d(i)}finally{t?ae(W):W()}}}}}const be={json:"application/json",text:"text/plain"};function ee(e){return e&&ce(e,"immediate","refetch","initialData","timeout","beforeFetch","afterFetch","onFetchError","fetch","updateDataOnError")}function X(e){return typeof Headers<"u"&&e instanceof Headers?Object.fromEntries([...e.entries()]):e}function Oe(e,...r){var n;const c=typeof AbortController=="function";let p={},o={immediate:!0,refetch:!1,timeout:0,updateDataOnError:!1};const a={method:"GET",type:"text",payload:void 0};r.length>0&&(ee(r[0])?o={...o,...r[0]}:p=r[0]),r.length>1&&ee(r[1])&&(o={...o,...r[1]});const{fetch:x=(n=K)==null?void 0:n.fetch,initialData:N,timeout:b}=o,f=Q(),s=Q(),g=Q(),d=V(!1),m=V(!1),y=V(!1),h=V(null),_=I(null),S=I(null),P=I(N||null),W=se(()=>c&&m.value);let T,D;const H=()=>{c&&(T==null||T.abort(),T=new AbortController,T.signal.onabort=()=>y.value=!0,p={...p,signal:T.signal})},E=u=>{m.value=u,d.value=!u};b&&(D=ue(H,b,{immediate:!1}));let t=0;const i=async(u=!1)=>{var w,O;H(),E(!0),S.value=null,h.value=null,y.value=!1,t+=1;const M=t,j={method:a.method,headers:{}};if(a.payload){const l=X(j.headers),F=B(a.payload);!a.payloadType&&F&&Object.getPrototypeOf(F)===Object.prototype&&!(F instanceof FormData)&&(a.payloadType="json"),a.payloadType&&(l["Content-Type"]=(w=be[a.payloadType])!=null?w:a.payloadType),j.body=a.payloadType==="json"?JSON.stringify(F):F}let Z=!1;const z={url:B(e),options:{...j,...p},cancel:()=>{Z=!0}};if(o.beforeFetch&&Object.assign(z,await o.beforeFetch(z)),Z||!x)return E(!1),Promise.resolve(null);let C=null;return D&&D.start(),x(z.url,{...j,...z.options,headers:{...X(j.headers),...X((O=z.options)==null?void 0:O.headers)}}).then(async l=>{if(_.value=l,h.value=l.status,C=await l.clone()[a.type](),!l.ok)throw P.value=N||null,new Error(l.statusText);return o.afterFetch&&({data:C}=await o.afterFetch({data:C,response:l})),P.value=C,f.trigger(l),l}).catch(async l=>{let F=l.message||l.name;if(o.onFetchError&&({error:F,data:C}=await o.onFetchError({data:C,error:l,response:_.value})),S.value=F,o.updateDataOnError&&(P.value=C),s.trigger(l),u)throw l;return null}).finally(()=>{M===t&&E(!1),D&&D.stop(),g.trigger(null)})},v=q(o.refetch);Y([v,q(e)],([u])=>u&&i(),{deep:!0});const G={isFinished:d,statusCode:h,response:_,error:S,data:P,isFetching:m,canAbort:W,aborted:y,abort:H,execute:i,onFetchResponse:f.on,onFetchError:s.on,onFetchFinally:g.on,get:A("GET"),put:A("PUT"),post:A("POST"),delete:A("DELETE"),patch:A("PATCH"),head:A("HEAD"),options:A("OPTIONS"),json:J("json"),text:J("text"),blob:J("blob"),arrayBuffer:J("arrayBuffer"),formData:J("formData")};function A(u){return(w,O)=>{if(!m.value)return a.method=u,a.payload=w,a.payloadType=O,fe(a.payload)&&Y([v,q(a.payload)],([M])=>M&&i(),{deep:!0}),{...G,then(M,j){return $().then(M,j)}}}}function $(){return new Promise((u,w)=>{de(d).toBe(!0).then(()=>u(G)).catch(O=>w(O))})}function J(u){return()=>{if(!m.value)return a.type=u,{...G,then(w,O){return $().then(w,O)}}}}return o.immediate&&Promise.resolve().then(()=>i()),{...G,then(u,w){return $().then(u,w)}}}export{Se as a,Oe as b,K as d,Ee as u};
